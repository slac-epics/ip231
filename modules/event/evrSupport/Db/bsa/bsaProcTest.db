#! Generated by VisualDCT v2.5
#! DBDSTART
#! DBD("../../dbd/edef.dbd")
#! DBDEND


record(doubSub, "$(DEV):CHECK$(MDID)") {
  field(DESC, "Check if Pulse Used")
  field(SNAM, "evrPatternSimTest")
  field(INPF, "$(DEV):MODIFIER4")
  field(INPP, "EDEF:$(LOCA):$(MD):INCLUSION4 CA")
  field(INPW, "$(DEV):BEAMCODE.SEVR")
  field(BRSV, "INVALID")
  field(FLNK, "$(DEV):MODMATCH$(MDID)")
  field(INPA, "EDEF:$(LOCA):$(MD):CTRL CA")
  field(INPB, "$(DEV):MEASCNT$(MDID)")
  field(INPD, "$(DEV):DONE$(MDID)")
  field(INPU, "EDEF:$(LOCA):$(MD):INCLUSION2 CA")
  field(INPV, "EDEF:$(LOCA):$(MD):INCLUSION3 CA")
  field(DISV, "0")
  field(SDIS, "$(DEV):STATE$(MD)")
  field(INPI, "EDEF:$(LOCA):$(MD):AVGCNT CA")
  field(INPJ, "EDEF:$(LOCA):$(MD):MEASCNT CA")
}

record(calcout, "$(DEV):STATE$(MD)") {
  field(DESC, "Change Processing State")
  field(CALC, "B?0:A")
  field(INPA, "EDEF:$(LOCA):$(MD):CTRL CPP")
  field(HOPR, "1")
  field(OOPT, "On Change")
  field(INPB, "$(DEV):DONE$(MDID)")
}

record(seq, "$(DEV):RESETSEQ$(MD)") {
  field(DESC, "EDEF $(MDID) Reset Sequence")
  field(SELM, "All")
  field(LNK1, "$(DEV):INIT$(MDID) PP")
  field(LNK2, "$(DEV):CHECK$(MDID)")
  field(LNK3, "$(DEV):CHECK$(MDID).Y")
  field(LNK4, "$(DEV):CHECK$(MDID).Z")
  field(DOL5, "0")
  field(LNK5, "$(DEV):MEASCNT$(MDID)")
  field(DOL6, "0")
  field(LNK6, "$(DEV):DONE$(MDID)")
  field(DOL1, "1")
  field(DOL8, "0")
  field(LNK8, "$(DEV):INIT$(MDID) PP")
}

record(bo, "$(DEV):INIT$(MDID)") {
  field(DOL, "$(DEV):CHECK$(MDID)")
  field(ZNAM, "OFF")
  field(ONAM, "ON")
}

record(bo, "$(DEV):MODMATCH$(MDID)") {
  field(FLNK, "$(DEV):MEASCNT$(MDID)")
  field(DOL, "$(DEV):CHECK$(MDID)")
  field(OMSL, "closed_loop")
  field(ZNAM, "OFF")
  field(ONAM, "ON")
}

record(calcout, "$(DEV):DONE$(MDID)") {
  field(CALC, "C?1:0")
  field(FLNK, "$(DEV):STATE$(MD)")
  field(INPC, "$(DEV):CHECK$(MDID).Q")
}

record(calcout, "$(DEV):MEASCNT$(MDID)") {
  field(DESC, "pulses counted")
  field(PINI, "YES")
  field(FLNK, "$(DEV):DONE$(MDID)")
  field(VAL, "0")
  field(HOPR, "280000")
  field(LOPR, "-1")
  field(MDEL, "0")
  field(CALC, "A?B+1:B")
  field(INPA, "$(DEV):MODMATCH$(MDID)")
  field(INPB, "$(DEV):MEASCNT$(MDID)")
}

#! Further lines contain data used by VisualDCT
#! View(1829,2001,1.0)
#! Record("$(DEV):CHECK$(MDID)",1538,2184,0,0,"$(DEV):CHECK$(MDID)")
#! Field("$(DEV):CHECK$(MDID).FLNK",16777215,1,"$(DEV):CHECK$(MDID).FLNK")
#! Link("$(DEV):CHECK$(MDID).FLNK","$(DEV):MODMATCH$(MDID)")
#! Field("$(DEV):CHECK$(MDID).INPF",16777215,1,"$(DEV):CHECK$(MDID).INPF")
#! Field("$(DEV):CHECK$(MDID).INPP",16777215,1,"$(DEV):CHECK$(MDID).INPP")
#! Field("$(DEV):CHECK$(MDID).INPW",16777215,1,"$(DEV):CHECK$(MDID).INPW")
#! Field("$(DEV):CHECK$(MDID).Y",16777215,0,"$(DEV):CHECK$(MDID).Y")
#! Field("$(DEV):CHECK$(MDID).Z",16777215,0,"$(DEV):CHECK$(MDID).Z")
#! Field("$(DEV):CHECK$(MDID).VAL",16777215,1,"$(DEV):CHECK$(MDID).VAL")
#! Field("$(DEV):CHECK$(MDID).INPA",16777215,1,"$(DEV):CHECK$(MDID).INPA")
#! Field("$(DEV):CHECK$(MDID).INPB",16777215,1,"$(DEV):CHECK$(MDID).INPB")
#! Link("$(DEV):CHECK$(MDID).INPB","$(DEV):MEASCNT$(MDID).VAL")
#! Field("$(DEV):CHECK$(MDID).Q",16777215,1,"$(DEV):CHECK$(MDID).Q")
#! Field("$(DEV):CHECK$(MDID).INPD",16777215,1,"$(DEV):CHECK$(MDID).INPD")
#! Link("$(DEV):CHECK$(MDID).INPD","$(DEV):DONE$(MDID).VAL")
#! Field("$(DEV):CHECK$(MDID).INPU",16777215,1,"$(DEV):CHECK$(MDID).INPU")
#! Field("$(DEV):CHECK$(MDID).INPV",16777215,1,"$(DEV):CHECK$(MDID).INPV")
#! Field("$(DEV):CHECK$(MDID).SDIS",16777215,0,"$(DEV):CHECK$(MDID).SDIS")
#! Link("$(DEV):CHECK$(MDID).SDIS","$(DEV):STATE$(MD).VAL")
#! Field("$(DEV):CHECK$(MDID).INPI",16777215,1,"$(DEV):CHECK$(MDID).INPI")
#! Field("$(DEV):CHECK$(MDID).INPJ",16777215,1,"$(DEV):CHECK$(MDID).INPJ")
#! Record("$(DEV):STATE$(MD)",1154,2201,0,1,"$(DEV):STATE$(MD)")
#! Field("$(DEV):STATE$(MD).INPA",16777215,1,"$(DEV):STATE$(MD).INPA")
#! Field("$(DEV):STATE$(MD).INPB",16777215,1,"$(DEV):STATE$(MD).INPB")
#! Link("$(DEV):STATE$(MD).INPB","$(DEV):DONE$(MDID).VAL")
#! Field("$(DEV):STATE$(MD).VAL",16777215,1,"$(DEV):STATE$(MD).VAL")
#! Record("$(DEV):RESETSEQ$(MD)",1144,2895,0,0,"$(DEV):RESETSEQ$(MD)")
#! Field("$(DEV):RESETSEQ$(MD).LNK1",16777215,1,"$(DEV):RESETSEQ$(MD).LNK1")
#! Link("$(DEV):RESETSEQ$(MD).LNK1","$(DEV):INIT$(MDID).VAL")
#! Field("$(DEV):RESETSEQ$(MD).LNK2",16777215,1,"$(DEV):RESETSEQ$(MD).LNK2")
#! Link("$(DEV):RESETSEQ$(MD).LNK2","$(DEV):CHECK$(MDID).VAL")
#! Field("$(DEV):RESETSEQ$(MD).LNK3",16777215,1,"$(DEV):RESETSEQ$(MD).LNK3")
#! Link("$(DEV):RESETSEQ$(MD).LNK3","$(DEV):CHECK$(MDID).Y")
#! Field("$(DEV):RESETSEQ$(MD).LNK4",16777215,1,"$(DEV):RESETSEQ$(MD).LNK4")
#! Link("$(DEV):RESETSEQ$(MD).LNK4","$(DEV):CHECK$(MDID).Z")
#! Field("$(DEV):RESETSEQ$(MD).LNK5",16777215,1,"$(DEV):RESETSEQ$(MD).LNK5")
#! Link("$(DEV):RESETSEQ$(MD).LNK5","$(DEV):MEASCNT$(MDID).VAL")
#! Field("$(DEV):RESETSEQ$(MD).LNK6",16777215,1,"$(DEV):RESETSEQ$(MD).LNK6")
#! Link("$(DEV):RESETSEQ$(MD).LNK6","$(DEV):DONE$(MDID).VAL")
#! Field("$(DEV):RESETSEQ$(MD).LNK8",16777215,1,"$(DEV):RESETSEQ$(MD).LNK8")
#! Link("$(DEV):RESETSEQ$(MD).LNK8","$(DEV):INIT$(MDID).VAL")
#! Record("$(DEV):INIT$(MDID)",2010,2954,0,1,"$(DEV):INIT$(MDID)")
#! Field("$(DEV):INIT$(MDID).VAL",16777215,0,"$(DEV):INIT$(MDID).VAL")
#! Field("$(DEV):INIT$(MDID).DOL",16777215,0,"$(DEV):INIT$(MDID).DOL")
#! Link("$(DEV):INIT$(MDID).DOL","$(DEV):CHECK$(MDID).VAL")
#! Record("$(DEV):MODMATCH$(MDID)",1938,2448,0,0,"$(DEV):MODMATCH$(MDID)")
#! Field("$(DEV):MODMATCH$(MDID).DOL",16777215,0,"$(DEV):MODMATCH$(MDID).DOL")
#! Link("$(DEV):MODMATCH$(MDID).DOL","$(DEV):CHECK$(MDID).VAL")
#! Field("$(DEV):MODMATCH$(MDID).FLNK",16777215,1,"$(DEV):MODMATCH$(MDID).FLNK")
#! Link("$(DEV):MODMATCH$(MDID).FLNK","$(DEV):MEASCNT$(MDID)")
#! Field("$(DEV):MODMATCH$(MDID).VAL",16777215,1,"$(DEV):MODMATCH$(MDID).VAL")
#! Record("$(DEV):DONE$(MDID)",2530,2306,0,0,"$(DEV):DONE$(MDID)")
#! Field("$(DEV):DONE$(MDID).FLNK",16777215,0,"$(DEV):DONE$(MDID).FLNK")
#! Link("$(DEV):DONE$(MDID).FLNK","$(DEV):STATE$(MD)")
#! Field("$(DEV):DONE$(MDID).INPC",16777215,0,"$(DEV):DONE$(MDID).INPC")
#! Link("$(DEV):DONE$(MDID).INPC","$(DEV):CHECK$(MDID).Q")
#! Field("$(DEV):DONE$(MDID).VAL",16777215,0,"$(DEV):DONE$(MDID).VAL")
#! Record("$(DEV):MEASCNT$(MDID)",2266,2526,0,0,"$(DEV):MEASCNT$(MDID)")
#! Field("$(DEV):MEASCNT$(MDID).FLNK",16777215,1,"$(DEV):MEASCNT$(MDID).FLNK")
#! Link("$(DEV):MEASCNT$(MDID).FLNK","$(DEV):DONE$(MDID)")
#! Field("$(DEV):MEASCNT$(MDID).VAL",16777215,0,"$(DEV):MEASCNT$(MDID).VAL")
#! Field("$(DEV):MEASCNT$(MDID).INPA",16777215,0,"$(DEV):MEASCNT$(MDID).INPA")
#! Link("$(DEV):MEASCNT$(MDID).INPA","$(DEV):MODMATCH$(MDID).VAL")
#! Field("$(DEV):MEASCNT$(MDID).INPB",16777215,0,"$(DEV):MEASCNT$(MDID).INPB")
#! Link("$(DEV):MEASCNT$(MDID).INPB","$(DEV):MEASCNT$(MDID).VAL")
#! TextBox(TB7,1809,2873,2129,3013,0,"Dialog",12,1,16777215,"EVR IOCs monitor $(DEV):INIT records to know when to reset, in order to reset their counters, etc, ahead of the first beam pulse.",null)
#! TextBox(TB6,816,2728,1336,2848,0,"Dialog",12,0,16777215,"EVG RESET$MD records\n* Processed when EDEF CTRL is processed.  .\n* Processed before any  device or EVG GO record is turned on so EVG always reset first\n* Resets EVG CHECK$MDID VAL to \"no match\", Y to \"not seen\" and Z to \"first time\"\n   (all these conditions are 0)\n* EVG CHECK processing then properly initialized and device AVGCNT records\n   will do nothing until EVG CHECK processing begins ",null)
#! TextBox(TB5,845,2477,1325,2677,0,"Dialog",12,0,16777215,"EVG STATE$MD and GO$MD\n* GO$MD records are Initialized to SCAN=PASSIVE\n* STATE$MD will set SCAN=IO_Intr when EDEF CTRL is ON\n* Device support will then interrupt at up to 360hz and cause GO$MD to process\n* GO$MD then processes it's FLNK (EVG CHECK$MDID \n* STATE$MD will set SCAN=PASSIVE when EDEF CTRL is OFF\n  and device support will no longer cause processing of GO$MD\n* STATE$MD is processed whenever EDEF CTRL is changed",null)
#! TextBox(TB3,2201,2892,2333,3050,0,"Dialog",12,1,16777215,"EVG sets Init upon pattern match for this EDEF so that EVR IOC EDEF recipeint can prepare (init its records) for when its modifier bit comes (PNET match + 2 ahead). It then clears on next cycle.",null)
#! TextBox(TB2,1879,2694,2258,2730,0,"Dialog",12,1,16777215,"Use the Modifier Match MODMATCH pv to enable EDEF.\n",null)
#! TextBox(TB1,1314,1887,1514,1967,0,"Dialog",13,1,16777215,"Macros:\nIOC = 4 char IOC name\nMD = measdef number\nMDID = measdef ID",null)
